class VideosController < InheritedResources::Base
  

 
  def upload
    @video = Video.create(params[:video])
    if @video
      @upload_info = Video.token_form(params[:video], save_video_new_video_url(:video_id => @video.id))
    end
   
  end

  def update
    @video     = Video.find(params[:id])
    @result    = Video.update_video(@video, params[:video])
    respond_to do |format|
      format.html do
        if @result
          redirect_to @video, :notice => "video successfully updated"
        else
          respond_to do |format|
            format.html { render "/home" }
          end
        end
      end
    end
  end

 def save_video
     
    @video = Video.find(params[:video_id])
      @user = User.find(current_user.id)
      @video.update_attributes(:yt_video_id =>params[:id].to_s, :is_complete => true, :user_id => current_user.id) 
   if params[:status].to_i == 200
      Video.delete_incomplete_videos
   else
      Video.delete_video(@video)
   end
    @user.update_attribute(:hasVideo, true)
    flash[:success] = "You're video has been uploaded, please wait while we check to make sure you're content is safe to be seen by the rest of humanity."
    redirect_to home_path(:user_id => @user.id)
   end

  def destroy
    @video = Video.find(params[:id])
    if Video.delete_video(@video)
      flash[:notice] = "video successfully deleted"
    else
      flash[:error] = "video unsuccessfully deleted"
    end
    redirect_to videos_path
  end

  def pre_upload
    @upload_info = Video.token_form(params[:video], home_path)
  end

 def vid_swap

 @current_video = Video.find(params[:video])

	respond_to do |format|
	format.js{}	
	end
 end
 
 def vid_bank

   if params[:user_id] == nil
    @video_list = Video.order("points DESC").limit(15)
   else 
    @user = User.find(params[:user_id])
    @video_list = @user.videos.order("points DESC")
   end


   if(params[:video] != nil)
    @current_video = Video.find(params[:video])
   else 
    @current_video = @video_list[0]
   end

   if params[:myVid] == true 
    @myVid = true
   end

   respond_to do |format|
     format.js{}
   end
 end

  protected
    def collection
      @videos ||= end_of_association_chain.completes
    end
  
   
end
